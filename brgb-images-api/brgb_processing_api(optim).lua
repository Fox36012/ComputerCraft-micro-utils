local a={{0xF0,0xF0,0xF0},{0xF2,0xB2,0x33},{0xE5,0x7F,0xD8},{0x99,0xB2,0xF2},{0xDE,0xDE,0x6C},{0x7F,0xCC,0x19},{0xF2,0xB2,0xCC},{0x4C,0x4C,0x4C},{0x99,0x99,0x99},{0x4C,0x99,0xB2},{0xB2,0x66,0xE5},{0x33,0x66,0xCC},{0x7F,0x66,0x4C},{0x57,0xA6,0x4E},{0xCC,0x4C,0x4C},{0x11,0x11,0x11}}local b={colors.white,colors.orange,colors.magenta,colors.lightBlue,colors.yellow,colors.lime,colors.pink,colors.gray,colors.lightGray,colors.cyan,colors.purple,colors.blue,colors.brown,colors.green,colors.red,colors.black}local function c(d,e,f,g,h,i)return math.sqrt((d-g)^2+(e-h)^2+(f-i)^2)end;local function j(k,l,m)local n=1;local o=c(k,l,m,a[1][1],a[1][2],a[1][3])for p=2,#a do local q=c(k,l,m,a[p][1],a[p][2],a[p][3])if q<o then o=q;n=p end end;return n-1 end;local function r(s,t,u)local v={}for w=1,u do v[w]={}for x=1,t do v[w][x]={s[w][x][1],s[w][x][2],s[w][x][3]}end end;for w=1,u do for x=1,t do local y,z,A=v[w][x][1],v[w][x][2],v[w][x][3]local B=j(y,z,A)local C,D,E=a[B+1][1],a[B+1][2],a[B+1][3]v[w][x]=B;local F=y-C;local G=z-D;local H=A-E;if x<t then local I,J,K=v[w][x+1][1],v[w][x+1][2],v[w][x+1][3]v[w][x+1]={math.max(0,math.min(255,I+F*7/16)),math.max(0,math.min(255,J+G*7/16)),math.max(0,math.min(255,K+H*7/16))}end;if w<u then if x>1 then local L,M,N=v[w+1][x-1][1],v[w+1][x-1][2],v[w+1][x-1][3]v[w+1][x-1]={math.max(0,math.min(255,L+F*3/16)),math.max(0,math.min(255,M+G*3/16)),math.max(0,math.min(255,N+H*3/16))}end;local O,P,Q=v[w+1][x][1],v[w+1][x][2],v[w+1][x][3]v[w+1][x]={math.max(0,math.min(255,O+F*5/16)),math.max(0,math.min(255,P+G*5/16)),math.max(0,math.min(255,Q+H*5/16))}if x<t then local R,S,T=v[w+1][x+1][1],v[w+1][x+1][2],v[w+1][x+1][3]v[w+1][x+1]={math.max(0,math.min(255,R+F*1/16)),math.max(0,math.min(255,S+G*1/16)),math.max(0,math.min(255,T+H*1/16))}end end end end;return v end;local function U(V)local W=fs.open(V,"rb")if not W then error("Cannot open file: "..V)end;local X=W.read(2)if X~="BM"then W.close()error("Not a BMP file")end;W.seek("set",18)local Y={string.byte(W.read(1)),string.byte(W.read(1)),string.byte(W.read(1)),string.byte(W.read(1))}local Z={string.byte(W.read(1)),string.byte(W.read(1)),string.byte(W.read(1)),string.byte(W.read(1))}local t=Y[1]+Y[2]*256+Y[3]*65536+Y[4]*16777216;local u=Z[1]+Z[2]*256+Z[3]*65536+Z[4]*16777216;W.seek("set",54)local s={}local _=math.ceil(t*3/4)*4;local a0=_-t*3;for w=u,1,-1 do s[w]={}for x=1,t do local m=string.byte(W.read(1))local l=string.byte(W.read(1))local k=string.byte(W.read(1))s[w][x]={k,l,m}end;if a0>0 then W.seek("cur",a0)end end;W.close()return s,t,u end;local function a1(V,a2,t,u)local W=fs.open(V,"wb")W.write("BRGB")W.write(string.char(math.floor(t/256),t%256))W.write(string.char(math.floor(u/256),u%256))for w=1,u do for x=1,t do W.write(string.char(a2[w][x]))end end;W.close()end;local function a3(V)local W=fs.open(V,"rb")if not W then return nil end;local X=W.read(4)if X~="BRGB"then W.close()return nil end;local t=string.byte(W.read(1))*256+string.byte(W.read(1))local u=string.byte(W.read(1))*256+string.byte(W.read(1))local a2={}for w=1,u do a2[w]={}for x=1,t do a2[w][x]=string.byte(W.read(1))end end;W.close()return a2,t,u end;local function a4(a5,a6,a7)local s,t,u=U(a5)local a8={}if a7 then a8=r(s,t,u)else for w=1,u do a8[w]={}for x=1,t do local k,l,m=s[w][x][1],s[w][x][2],s[w][x][3]a8[w][x]=j(k,l,m)end end end;a1(a6,a8,t,u)return t,u end;local function a9(V)local a2,t,u=a3(V)if not a2 then error("Cannot load BRGB file: "..V)end;for w=1,u do for x=1,t do local aa=a2[w][x]local ab=b[aa+1]term.setPixel(x,w,ab)end end end;local function ac(s,t,u,a7)term.setGraphicsMode(1)local a8;if a7 then a8=r(s,t,u)else a8={}for w=1,u do a8[w]={}for x=1,t do local k,l,m=s[w][x][1],s[w][x][2],s[w][x][3]a8[w][x]=j(k,l,m)end end end;for w=1,u do for x=1,t do local aa=a8[w][x]local ab=b[aa+1]term.setPixel(x,w,ab)end end;term.setGraphicsMode(0)end;return{processBMP=a4,displayBRGB=a9,loadBRGB=a3,saveBRGB=a1,previewImage=ac}